<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Disciple Vertueux: 365 Prop√≥sitos de Dios para tu vida - Un devocional interactivo en franc√©s">
    <meta name="theme-color" content="#d4a5a5">
    <title>Disciple Vertueux - 365 Prop√≥sitos de Dios</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        #days-container {
            display: flex;
            flex-direction: column;
        }
        
        .month-filter {
            position: sticky;
            top: 0;
            background-color: white;
            padding: 10px 15px;
            border-bottom: 2px solid #d4a5a5;
            z-index: 100;
            display: flex;
            gap: 10px;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            justify-content: flex-start;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            scroll-behavior: smooth;
        }
        
        .month-filter::-webkit-scrollbar {
            height: 4px;
        }
        
        .month-filter::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .month-filter::-webkit-scrollbar-thumb {
            background: #d4a5a5;
            border-radius: 2px;
        }
        
        .month-filter::-webkit-scrollbar-thumb:hover {
            background: #c4959a;
        }
        
        .month-button {
            padding: 8px 15px;
            border: 2px solid #d4a5a5;
            background-color: white;
            color: #333;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            flex-shrink: 0;
            white-space: nowrap;
            font-family: Georgia, serif;
        }
        
        .month-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .month-button.active {
            background-color: #d4a5a5;
            color: white;
            opacity: 1;
            transform: scale(1.05);
        }
        
        .notes-textarea {
            width: 100%;
            min-height: 200px;
            padding: 10px;
            border: 1px solid #d4a5a5;
            border-radius: 4px;
            font-family: Georgia, serif;
            font-size: 1rem;
            color: #5a5a5a;
            resize: vertical;
            background-color: rgba(255, 255, 255, 0.7);
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- P√°gina de Portada -->
        <section class="page cover-page" id="portada">
            <div class="watercolor-accent corner-accent"></div>
            <div class="page-content">
                <div class="cover-image">
                    <img src="images/cover_illustration_new.png" alt="Disciple Vertueux">
                </div>
            </div>
        </section>

        <!-- Filtro de Meses -->
        <div class="month-filter" id="monthFilter"></div>

        <!-- Contenedor de D√≠as -->
        <div id="days-container"></div>
    </div>

    <!-- PWA Install Prompt -->
    <div class="install-prompt" id="installPrompt" style="display: none; position: fixed; bottom: 20px; right: 20px; background: linear-gradient(135deg, #c77b7b 0%, #7b7bc7 100%); color: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1000; max-width: 350px; animation: slideUp 0.3s ease-out;">
        <div class="install-prompt-icon" style="font-size: 2.5em; margin-bottom: 10px;">üì±</div>
        <div class="install-prompt-text">
            <div class="install-prompt-title" style="font-size: 1.2em; font-weight: bold; margin-bottom: 8px;">‚ú® Installez Disciple Vertueux!</div>
            <div class="install-prompt-subtitle" style="font-size: 0.9em; margin-bottom: 15px; opacity: 0.95;">Acc√©dez √† votre d√©votionnel depuis n'importe o√π, m√™me hors ligne</div>
        </div>
        <div class="install-prompt-buttons" style="display: flex; gap: 10px;">
            <button class="install-btn primary" id="installBtn" style="flex: 1; padding: 10px; background: white; color: #c77b7b; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; transition: all 0.2s;">Installer</button>
            <button class="install-btn" id="dismissBtn" style="flex: 1; padding: 10px; background: rgba(255,255,255,0.2); color: white; border: 1px solid white; border-radius: 5px; cursor: pointer; transition: all 0.2s;">Plus tard</button>
        </div>
    </div>
    
    <style>
        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .install-prompt-buttons button:hover {
            transform: scale(1.05);
        }
    </style>

    <script src="js/script.js"></script>
    <script>
        // Cargar datos de d√≠as y generar HTML din√°micamente
        async function loadAndGenerateDays() {
            try {
                const response = await fetch('data/dias_365.json');
                const dias = await response.json();
                
                const container = document.getElementById('days-container');
                const monthFilter = document.getElementById('monthFilter');
                
                // Limpiar el contenedor del filtro de meses
                monthFilter.innerHTML = '';
                
                // Crear bot√≥n "Todos los meses"
                const allButton = document.createElement('button');
                allButton.textContent = 'Tous les mois';
                allButton.className = 'month-button active';
                allButton.addEventListener('click', function() {
                    showAllDays();
                    updateActiveButton(this);
                });
                monthFilter.appendChild(allButton);
                
                // Crear botones para cada mes
                const monthNames = ['Janvier', 'F√©vrier', 'Mars', 'Avril', 'Mai', 'Juin',
                                   'Juillet', 'Ao√ªt', 'Septembre', 'Octobre', 'Novembre', 'D√©cembre'];
                const monthColors = ['#FFE5E5', '#FFE5F0', '#E5F0FF', '#E5FFE5', '#FFFFE5', '#FFE5CC',
                                    '#FFE5E5', '#FFE5CC', '#FFFFE5', '#E5FFE5', '#E5F0FF', '#FFE5F0'];
                
                for (let i = 0; i < 12; i++) {
                    const button = document.createElement('button');
                    button.textContent = monthNames[i];
                    button.className = 'month-button';
                    button.dataset.month = i + 1;
                    button.style.backgroundColor = monthColors[i];
                    button.addEventListener('click', function() {
                        filterDaysByMonth(i + 1);
                        updateActiveButton(this);
                    });
                    monthFilter.appendChild(button);
                }
                
                // Generar HTML para cada d√≠a
                dias.forEach((dia, index) => {
                    const section = document.createElement('section');
                    section.className = 'page daily-page';
                    section.id = `dia-${dia.id}`;
                    section.dataset.month = dia.month_num;
                    section.innerHTML = `
                        <div class="watercolor-accent corner-small"></div>
                        <div class="page-content">
                            <div class="left-column">
                                <div class="bible-reading">
                                    <h4>Lecture Biblique:</h4>
                                    <div class="bible-text">
                                        "${dia.verset}"
                                    </div>
                                    <p class="bible-reference">${dia.reference}</p>
                                </div>

                                <div class="daily-message">
                                    <h4>Message Personnel:</h4>
                                    <p>${dia.message.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')}</p>
                                </div>
                            </div>

                            <div class="right-column">
                                <div class="date-square" style="background-color: ${monthColors[dia.month_num - 1]};">
                                    <div class="day-number">${dia.day_num}</div>
                                    <div class="day-date">${dia.day_num} de ${dia.month_name}</div>
                                </div>

                                <div class="personal-notes">
                                    <h4>Mes Notes:</h4>
                                    <div class="notes-space"></div>
                                </div>

                                <div class="handwritten-note">
                                    <p>"${dia.affirmation}"</p>
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(section);
                });
                
                // Inicializar funcionalidades
                initializeNotes();
                setupScrollAnimation();
                
            } catch (error) {
                console.error('Error cargando d√≠as:', error);
            }
        }
        
        function showAllDays() {
            const dailyPages = document.querySelectorAll('.daily-page');
            dailyPages.forEach(page => {
                page.style.display = 'block';
            });
        }
        
        function filterDaysByMonth(month) {
            const dailyPages = document.querySelectorAll('.daily-page');
            dailyPages.forEach(page => {
                const pageMonth = parseInt(page.dataset.month);
                page.style.display = pageMonth === month ? 'block' : 'none';
            });
        }
        
        function updateActiveButton(activeButton) {
            const buttons = document.querySelectorAll('.month-button');
            buttons.forEach(btn => {
                btn.classList.remove('active');
            });
            activeButton.classList.add('active');
        }
        
        function initializeNotes() {
            const notesSpaces = document.querySelectorAll('.notes-space');
            
            notesSpaces.forEach(notesSpace => {
                const dailyPage = notesSpace.closest('.daily-page');
                if (!dailyPage) return;
                
                const pageId = dailyPage.id;
                const storageKey = `notes-${pageId}`;
                
                // Crear textarea funcional
                const textarea = document.createElement('textarea');
                textarea.className = 'notes-textarea';
                textarea.placeholder = '√âcrivez vos notes ici...';
                
                // Cargar notas guardadas
                const savedNotes = localStorage.getItem(storageKey);
                if (savedNotes) {
                    textarea.value = savedNotes;
                }
                
                // Guardar notas al escribir
                textarea.addEventListener('input', function() {
                    localStorage.setItem(storageKey, this.value);
                });
                
                // Reemplazar el contenido de notes-space con el textarea
                notesSpace.innerHTML = '';
                notesSpace.appendChild(textarea);
            });
        }
        
        function setupScrollAnimation() {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);

            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                page.style.opacity = '0';
                page.style.transform = 'translateY(30px)';
                page.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(page);
            });
        }
        
        // Cargar d√≠as cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', loadAndGenerateDays);
        
        // Registrar Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registrado correctamente:', registration);
                    })
                    .catch(error => {
                        console.error('‚ùå Error al registrar Service Worker:', error);
                    });
            });
        }
        
        // Manejar el evento beforeinstallprompt para PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            const installPrompt = document.getElementById('installPrompt');
            if (installPrompt) {
                installPrompt.style.display = 'flex';
            }
        });
        
        // Bot√≥n de instalaci√≥n
        const installBtn = document.getElementById('installBtn');
        if (installBtn) {
            installBtn.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`Usuario respondi√≥: ${outcome}`);
                    deferredPrompt = null;
                    const installPrompt = document.getElementById('installPrompt');
                    if (installPrompt) {
                        installPrompt.style.display = 'none';
                    }
                } else {
                    // Mostrar instrucciones manuales
                    showInstallInstructions();
                }
            });
        }
        
        // Bot√≥n de descartar
        const dismissBtn = document.getElementById('dismissBtn');
        if (dismissBtn) {
            dismissBtn.addEventListener('click', () => {
                const installPrompt = document.getElementById('installPrompt');
                if (installPrompt) {
                    installPrompt.style.display = 'none';
                }
            });
        }
        
        // Mostrar instrucciones de instalaci√≥n manual
        function showInstallInstructions() {
            // Crear un modal con instrucciones m√°s visibles
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 2000;';
            
            const content = document.createElement('div');
            content.style.cssText = 'background: white; padding: 30px; border-radius: 15px; max-width: 500px; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.3);';
            
            content.innerHTML = `
                <h2 style="color: #c77b7b; margin-top: 0; text-align: center; font-size: 1.5em;">üì± Installer Disciple Vertueux</h2>
                
                <div style="margin: 20px 0;">
                    <h3 style="color: #7b7bc7; margin-top: 20px; margin-bottom: 10px;">ü§ñ ANDROID:</h3>
                    <ol style="margin: 10px 0; padding-left: 20px;">
                        <li>Ouvrez le navigateur (Chrome, Edge, etc.)</li>
                        <li>Appuyez sur le menu (‚ãÆ) en haut √† droite</li>
                        <li>S√©lectionnez "Installer l'application" ou "Ajouter √† l'√©cran d'accueil"</li>
                        <li>Confirmez l'installation</li>
                    </ol>
                </div>
                
                <div style="margin: 20px 0;">
                    <h3 style="color: #5ba588; margin-top: 20px; margin-bottom: 10px;">üçé iOS (Safari):</h3>
                    <ol style="margin: 10px 0; padding-left: 20px;">
                        <li>Ouvrez Safari</li>
                        <li>Appuyez sur le bouton de partage (‚ÜóÔ∏è) en bas</li>
                        <li>Faites d√©filer et s√©lectionnez "Ajouter √† l'√©cran d'accueil"</li>
                        <li>Choisissez un nom et appuyez sur "Ajouter"</li>
                    </ol>
                </div>
                
                <p style="text-align: center; color: #666; margin-top: 20px; font-size: 0.9em;">‚ú® Votre app sera disponible sur votre √©cran d'accueil et fonctionnera m√™me hors ligne!</p>
                
                <button id="closeInstructionsBtn" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #c77b7b 0%, #7b7bc7 100%); color: white; border: none; border-radius: 5px; font-size: 1em; font-weight: bold; cursor: pointer; margin-top: 20px;">Fermer</button>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            document.getElementById('closeInstructionsBtn').addEventListener('click', () => {
                modal.remove();
            });
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        // Detectar si el app fue instalado
        window.addEventListener('appinstalled', () => {
            console.log('‚úÖ PWA instalada exitosamente');
            deferredPrompt = null;
        });
    </script>
</body>
</html>
